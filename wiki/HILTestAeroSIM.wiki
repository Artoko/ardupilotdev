#summary Testing the firmware in Hil mode with AeroSIM-RC.
#labels Featured

= Introduction =

Here you will find a good and cheap method to test yourself  the [http://code.google.com/p/arducopter/ ArduCopter] firmware in HIL (Hardware In the Loop) mode with the [http://www.aerosimrc.com/j/index.php/en AeroSIM-RC simulator].

http://ardupilotdev.googlecode.com/svn/images/AeroSIM_sim.jpg

== Details ==
*Hardware requirement:*
 * a PC computer,
 * an !ArduMega board APMv1 (1280, 2560)or APMv2,for the APMv1, no IMU shield is required (more info [http://code.google.com/p/ardupilot-mega/ HERE]),
 * the [http://www.aerosimrc.com/j/index.php/en/downloads AeroSIM-RC v3.81] simulator (Demo or Retail version): 
 * update the Aerosim-RC 3.81 to the v3.83 by downloading this update:  [http://www.aerosimrc.com/downloads/AeroSIMRC_3.83-3.81.exe]
 * the firmware [http://ardupilotdev.googlecode.com/files/ArduCopter_241xp2_DCM.zip ArduCopter v2.4.1xp2 DCM] or more installed on the APM,
 * the [http://code.google.com/p/ardupilot-mega/downloads/list Mission Planner v1.1.48] (or more) installed on the PC, you may download the latest version in the [http://code.google.com/p/ardupilot-mega/source/browse/ Ardupilot-mega official repository] with GIT
 * the [http://ardupilotdev.googlecode.com/files/ArduCopter_HIL_setups.zip HIL setups and param files] for the HIL simulation
 * You will find in the [http://ardupilotdev.googlecode.com/files/ArduCopter_HIL_setups.zip  ArduCopter_HIL_setups.zip], , the !AeroSim plug-in (plugin_AeroSIMRC.dll) in the AeroSIM_HIL/APMHil/ folder.
 * You will find also in the [http://ardupilotdev.googlecode.com/files/ArduCopter_HIL_setups.zip  ArduCopter_HIL_setups.zip], the quadcopter model MD4.mdl in the AeroSIM_HIL/ folder.

== Installation ==

 * Unzip the archive !ArduCopter_HIL_setups.zip
 * copy the folder \APMHill in the AeroSiM folder c:\Program Files (x86)\Plugin\
http://ardupilotdev.googlecode.com/svn/images/AeroSIM_plugin.jpg
 * copy the quadcopter model MD4.mdl in the AeroSiM folder c:\Program Files (x86)\Data\
http://ardupilotdev.googlecode.com/svn/images/AeroSIM_model1.jpg
 * check that in the firmware the parameters of the APM_Config.h are set, then upload the firmware to the APM:

{{{
  #define HIL_MODE 	HIL_MODE_ATTITUDE
  #define X_PLANE 	ENABLED
}}}
http://ardupilotdev.googlecode.com/svn/images/AeroSIM_uploadl.jpg

 * upload the AC241xp2_MD4_HIL.param (found in the !ArduCopter_HIL_setups\!AeroSim_Hill folder ) with the mission planner to your APM board.
http://ardupilotdev.googlecode.com/svn/images/MD4_PID.jpg

== Testing ==

 * launch the APM mission planner
 * click on the Tab *simulation*
 * click on *CONNECT* on the top right corner
 * click on the button *!AeroSim* and set the parameters as below:
http://ardupilotdev.googlecode.com/svn/images/AeroSIM_setup.jpg
 * click on the Tab *Configuration*, do the stick calibration
http://ardupilotdev.googlecode.com/svn/images/AeroSIM_calib.jpg
 * click on the Tab *Mode*, set the MODE
http://ardupilotdev.googlecode.com/svn/images/AeroSIM_Mode.jpg
 * click again on the Tab *simulation*
 * click on *Start simulation*
 * launch the *AeroSIM-RC* then select *Plugin* and *APMHil*
http://ardupilotdev.googlecode.com/svn/images/AeroSIM_plugin_select.jpg
 * select the model *MD4* 
http://ardupilotdev.googlecode.com/svn/images/AeroSIM_model.jpg

Enjoy flying with AeroSIM in HIL mode
http://ardupilotdev.googlecode.com/svn/images/AeroSIM_sim.jpg

You will find some videos of HIL simulations at: 

[http://vimeo.com/35097058]

[http://vimeo.com/37243083]

More infos at:
[http://diydrones.com/profile/JeanLouisNaudin]

Enjoy with the HIL simulation with *AeroSIM-RC*...

Regards, 
Jean-Louis